<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <style>
        table {
            font-family: Arial, Helvetica, sans-serif;
            border-collapse: collapse;
        }

        td, th {
            border: 1px solid #ddd;
            padding: 15px;
            width: auto;
            text-align: center;
        }

        td:nth-child(even){background-color: #c9b3b3;}
        tr:nth-child(even){background-color: #ddd;}
        
        tr:hover {background-color: #49b9c1;}
        td:hover {background-color: #d86666;}

        ul {
            width:300px;
        }

        li:hover {
            cursor: pointer;
            background-color: #49b9c1;
        }
        .Priority-1 {
            color:red;
        }
        .Priority-2 {
            color:green;
        }
        .Priority-3 {
            color:blue;
        }
        .Priority-4 {
            color:brown;
        }
        .Priority-5 {
            color:black;
        }


    </style>
</head>
<body onload="loadItems()">
    <h1>To-Do List</h1>

    <label for="task_input">Task Description:</label>
    <input id="task_input" type="text"><br><br>

    <label for="task_priority_input">Task Priority:</label>
    <input id="task_priority_input" type="text"><br><br>

    <button onclick='addTask();'>Add Task</button>
    <button onClick='saveToLocalStorage();'>Save to Local Storage</button><br><br>

    <h2>Task List</h2>
    <ul id="task_list"></ul>
    

    <script>

        let tasks = [];

        class Task {

            constructor(task_priority, task_description) {
                this.task_priority = task_priority;
                this.task_description = task_description;
            }
        }

        const task_priority_input = document.getElementById("task_priority_input");
        const task_input = document.getElementById("task_input");

        task_priority_input.addEventListener("keypress", 
            (e) => {
                if (e.key === "Enter") {
                    event.preventDefault();
                    if (task_input.value) {
                        addTask();
                    } else {
                        task_input.focus();
                    }
                }
            }
        );

        task_input.addEventListener("keypress", 
            (e) => {
                if (e.key === "Enter") {
                    event.preventDefault();
                    if (task_priority_input.value) {
                        addTask();
                    } else {
                        task_priority_input.focus();
                    }
                }
            }
        );

        function saveToLocalStorage() {
            console.log(tasks);
            localStorage.setItem("taskItems", JSON.stringify(tasks));

        }

        function loadItems() {
            let items = localStorage.getItem("taskItems");
            tasks = JSON.parse(items);
            console.log(items);
            console.log(tasks);

            priority_classes = ["Priority-1", "Priority-2", "Priority-3", "Priority-4", "Priority-5"]
            const task_list = document.getElementById("task_list");
            
            for (let task of tasks) {
                let li = document.createElement('li');
                li.className = priority_classes[task.task_priority];
                li.textContent = priority_classes[task.task_priority] + ': ' + task.task_description;
                li.addEventListener("click", (e) => {
                    let text = "Are you sure you want to delete the task:\n" + e.srcElement.textContent;
                    if (confirm(text) == true) {
                        tasks.splice(tasks.map(t => (priority_classes[t.task_priority] + ': ' + t.task_description)).indexOf(e.srcElement.textContent), 1);
                        saveToLocalStorage();
                        e.srcElement.remove();
                    }
                });
                task_list.appendChild(li);
            }
        }

        function addTask() {
            priority_classes = ["Priority-1", "Priority-2", "Priority-3", "Priority-4", "Priority-5"]
            let li = document.createElement('li');
    
            let priority_index = Number(document.getElementById("task_priority_input").value)-1;

            // Handle out of range
            if (priority_index > priority_classes.length) {
                priority_index = priority_classes.length-1
            }

            li.className = priority_classes[priority_index];
            li.textContent = priority_classes[priority_index] + ': ' + document.getElementById("task_input").value;
            
            li.addEventListener("click", (e) => {   
                let text = "Are you sure you want to delete the task:\n" + e.srcElement.textContent;
                if (confirm(text) == true) {
                    tasks.splice(tasks.map(t => (priority_classes[t.task_priority] + ': ' + t.task_description)).indexOf(e.srcElement.textContent), 1);
                    saveToLocalStorage();
                    e.srcElement.remove();
                }
            });

            // Make a new Task Object
            tasks.push(new Task(priority_index, document.getElementById("task_input").value));

            const task_list = document.getElementById("task_list");
            task_list.appendChild(li);

            // Clear the form
            document.getElementById("task_input").value = "";
            document.getElementById("task_priority_input").value = "";

        }

    </script>
</body>
</html>
